<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
<head>
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="generator" content="Asciidoctor 2.0.18"/>
<meta name="description" content="Yodogawa-JankenとはNostr上で動作するBotの1つである。どのようにしてBotを作製していったかを語る。"/>
<meta name="keywords" content="Nostr じゃんけん"/>
<meta name="author" content="n0nakamura"/>
<meta name="copyright" content="Copyright © 2023 n0nakamura"/>
<link rel="icon" type="image/svg" href="01GSH7D013HQPGGT11GD277EN2.svg"/>
<title>Yodogawa-Jankenの製作記録 - i6n26</title>
<link rel="stylesheet" href="./style_asciidoctor.css"/>
</head>
<body class="article">
<div id="header">
<h1>Yodogawa-Jankenの製作記録 - i6n26</h1>
<div class="details">
<span id="author" class="author">n0nakamura</span><br/>
<span id="revnumber">version 0.0.1</span>
<br/><span id="revremark">draft</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_製作のきっかけ">1. 製作のきっかけ</a></li>
<li><a href="#_プロトタイプの作製">2. プロトタイプの作製</a></li>
<li><a href="#_ライブラリgo_nostr">3. ライブラリgo-nostr</a></li>
<li><a href="#_絵文字の対応">4. 絵文字の対応</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/n0nakamura/yodogawa-janken">Yodogawa-Janken</a> とはNostrのBotの1つである。基本的な機能として、手札をYodogawa-Jankenへメンションすると、Yodogawa-Jankenの手札と勝敗を返すプログラムである。このBotを製作した過程を以下に述べる。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_製作のきっかけ"><a class="link" href="#_製作のきっかけ">1. 製作のきっかけ</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>製作のきっかけは、2023年5月16日に投稿されたあおぎさんによる淀川さんのグー・チョキ・パーのイラスト (<a href="https://snort.social/e/nevent1qqsf7hnmta0m2d3xxm4gfm5ulfnwx93s757akthewkdc96ne9vz6f0qprpmhxue69uhkummnw3ezu6r0d3ukyetp9e3k7mf0qgs2c89dwl8xy0ej8pwp4czelhj5zcmcdrxtsxunfqssadztzxayl8grqsqqqqqplmlkuv">あおぎ - 淀川さんの手のイラストはこちらから自由に使ってください - Snort</a>) である。以前からNostrに関する何らかの開発をしたいと考えており、またじゃんけんのCLIプログラムはC言語で書いたことがあるため、じゃんけん機能を備えたBotを作製することにした。この頃は絵文字への対応は全く検討していなかった。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_プロトタイプの作製"><a class="link" href="#_プロトタイプの作製">2. プロトタイプの作製</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>単純なじゃんけんではつまらないため各手札の出現確率が一様にならないよう設定した。淀川さんの自撮りから、最も自然な手の状態がパー、続いてチョキ、最後にグーであると判断したため、それぞれ37%, 32%, 26%の割合で出現するようにした。かつ、ごく稀にYodogawa-sanが無条件で勝利する機能を加えた。この物語の主人公はYodogawa-sanである。スーパーマリオブラザーズにスーパースターがあるように、Yodogawa-sanにも無敵状態があるのだ。</p>
</div>
<div class="paragraph">
<p>開発環境の導入容易度と言語の学習難易度の面から、Go言語を使用することにした。まずはじゃんけんをCLIアプリケーションとして実装し (<a href="https://github.com/n0nakamura/yodogawa-janken/commit/8bed4c660ad1a23692b86be374ad49759ba9c7af">Prototype rock-paper-scissors program running on the CLI · n0nakamura/yodogawa-janken@8bed4c6</a>) 、想定通りの動作をすることが確認できた。5月17日の出来事である。あとは入出力をNostrリレーとの通信に置換するだけであるが、実際に利用できるようになるまで1ヶ月かかった。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ライブラリgo_nostr"><a class="link" href="#_ライブラリgo_nostr">3. ライブラリgo-nostr</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Go言語にもNostrのライブラリ go-nostr (<a href="https://github.com/nbd-wtf/go-nostr">nbd-wtf/go-nostr： Nostr library for Golang</a>) がある。go-nostrのExamplesを参考に、リレーの購読と投稿だけを行うプログラムを書いた。mattnさんのnostr-makeitquote (<a href="https://github.com/mattn/nostr-makeitquote">mattn/nostr-makeitquote</a>) は非常に参考にさせていただいた。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_絵文字の対応"><a class="link" href="#_絵文字の対応">4. 絵文字の対応</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>それまで手札を表す文字はアルファベット <code>R</code>, <code>S</code>, <code>P</code> のみであった。</p>
</div>
<div class="paragraph">
<p>ふと、手の絵文字があると手札が視覚的に理解しやすいと思い、手札の表記に絵文字を加えた。また、これに合わせて誤って絵文字でメンションをするユーザが生じることが予想されたため、絵文字にも反応するようにした (<a href="https://github.com/n0nakamura/yodogawa-janken/commit/82cf73f1058f79d0a0966227005d97af9c59baab">Add emoji supports · n0nakamura/yodogawa-janken@82cf73f</a>)。しかし、アルファベットの入力に比べ絵文字の入力は手間がかかるため、あくまでオプショナルな機能であった。</p>
</div>
<div class="paragraph">
<p>絵文字対応に本格的に乗り出した発端は、にこさんのメンションの絵文字 <code>✋</code> である。Yodogawa-Jankenにおけるパーの絵文字は <code>🖐</code> であったが、類似する絵文字に <code>✋</code> があった。混乱を防ぐため、 <code>✋</code> もパーとして扱うことにした (<a href="https://snort.social/e/nevent1qqsvdlwwm7mlwffngzcmxqzkz0rq6a6cstsdwf5rvm7407rmzr57wscpz4mhxue69uhhyetvv9ujuerpd46hxtnfduhsz8thwden5te0dehhxarj9e3xjarrda5kuetj9eek7cmfv9kz7fez3vg">n0nakamura - 実は🖐と✋があって、Yodogawa-Jankenが採用しているのは前者。紛らわしいので両方対応します。 - Snort</a>)。</p>
</div>
<div class="paragraph">
<p>Nostrのユーザの特徴を一言で形容するなら「好奇心旺盛」だろう。彼らは設定されていない絵文字をYodogawa-Jankenに投げかけるのである。未知を求める彼らに対し、私は絵文字を追加し続けた  (<a href="https://github.com/n0nakamura/yodogawa-janken/commit/8f9c6932c783d4bb99eb2ad5401b05f50dbc37e7">Add corresponding emojis and response patterns · n0nakamura/yodogawa-janken@8f9c693</a>, etc&#8230;&#8203;)。</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.0.1<br/>
Last updated 2023-06-16 02:01:43 UTC
</div>
</div>
</body>
</html>